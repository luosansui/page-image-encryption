import{r as n,j as g,a as e,f as B}from"./index-e1ac068f.js";import{L as _,C as K,B as $,c as T,T as q,a as F,S as G,g as H,b as J,s as Q,U as V,P as W,d as X,f as j,I as Y,m as Z}from"./zip-7e472e1e.js";const ee=[{title:"写入信息",description:"使用当前算法往图像中写入信息"},{title:"提取信息",description:"使用当前算法从图像中提取信息"}],A=l=>g("div",{className:"flex items-center mb-4 relative",children:[e("div",{className:"w-[64px] mr-3 whitespace-nowrap text-justify relative",style:{textAlignLast:"justify"},children:l.label}),l.children,l.message&&e("span",{className:"absolute ml-[32px] -bottom-[2px] left-1/2 -translate-x-1/2 translate-y-full text-xs text-red-400",children:l.message})]});function te({onStart:l,className:v,pluginList:c,disabled:o,onClearUpload:y,onClearOutput:h}){const[a,m]=n.useState(0),[f,N]=n.useState(0),[p,C]=n.useState(""),[L,i]=n.useState(""),[u,U]=n.useState("1"),[b,w]=n.useState(""),k=(t,r)=>r!=null&&r.required&&t===""?(w("秘钥不能为空"),!1):r!=null&&r.required&&(r!=null&&r.regex)&&!new RegExp(r.regex).test(t)?(w(r.message),!1):(w(""),!0),M=()=>{const t=c[a],r=["encrypt","decrypt"];if(!k(p,t.keyRule))return;const x=Number(u);x||U("1"),l==null||l({pluginName:t.name,optionName:r[f],key:p,message:f?"":L,repeat:x||1})},O=t=>{m(t)},P=t=>{N(t)},I=t=>{const r=t.target.value;C(r);const x=c[a];k(r,x==null?void 0:x.keyRule)},R=t=>{i(t.target.value)},E=t=>{U(t.target.value.trim())},z=()=>{y==null||y()},S=()=>{h==null||h()},D=t=>t.name??"未载入算法",s=t=>g(n.Fragment,{children:[e("div",{className:"font-semibold",children:t.name}),e("div",{className:"text-xs truncate my-1",children:t.description}),g("div",{className:"flex justify-between text-xs ",children:[e("span",{className:"text-gray-500",children:T(t.language)}),e("span",{className:"text-gray-400",children:t.version})]})]}),d=n.useMemo(()=>{var t;return((t=c[a])==null?void 0:t.componentRule)??{}},[a,c]);return g("div",{className:`text-gray-600 p-3 ${v??""}`,children:[e(_,{options:c,checkedIndex:a,disabled:o,onChange:O,renderSelected:D,renderList:s,className:"mb-4"}),e(K,{options:ee,disabled:o,onChange:P,className:"mb-4"}),e(A,{label:"秘钥",message:b,children:e("input",{type:"text",value:p,min:1,disabled:o,onChange:I,className:`${o?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),d.repeat&&e(A,{label:"重复次数",children:e("input",{type:"number",value:u,disabled:o,onChange:E,className:`${o?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),!!f||e(A,{label:"载入信息",children:e("input",{type:"text",value:L,disabled:o,onChange:R,className:`${o?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),g("div",{className:"text-center pt-2",children:[e($,{disabled:o,onClick:z,typeColor:"white",className:"mb-2 mr-2",children:"清空上传"}),e($,{disabled:o,onClick:S,typeColor:"white",className:"mb-2 mr-2",children:"清空输出"}),g($,{onClick:M,disabled:o,className:"mb-2",children:["开始",f?"提取":"写入"]})]})]})}const re=[{title:"隐写图",key:"image"},{title:"原图大小",key:"originSize"},{title:"隐写图大小",key:"currentSize"},{title:"压缩率",key:"compressionRatio"},{title:"承载信息",key:"message"},{title:"操作",key:"operate"}];function se({pairList:l,className:v,disabled:c,onRemove:o}){const[y,h]=n.useState(!1),[a,m]=n.useState(null),f=(i,u)=>{h(!0),m({src:i,name:u})},N=()=>{h(!1),m(null)},p=i=>{c||o==null||o(i)},C=({file:i})=>{c||Q(i,i.name)},L=()=>Array.from(l,([i,u,U])=>{const b=i.md5,w=e(J,{file:u,onClick:()=>f(u.src,u.file.name)}),k=B(i.file.size,"MB"),M=B(u.file.size,"MB"),O=H(i.file,u.file),P=g("div",{children:[e("span",{onClick:()=>C(u),className:"cursor-pointer select-none text-blue-500 font-semibold text-sm underline underline-offset-2 mx-2",children:"下载"}),e("span",{onClick:()=>p(i.md5),className:"cursor-pointer select-none text-red-500 font-semibold text-sm underline underline-offset-2 mx-2",children:"删除"})]});return{id:b,image:w,originSize:k,currentSize:M,compressionRatio:g("span",{className:`${O>100?"text-red-500":"text-green-500"}`,children:[O,"%"]}),message:e("div",{className:"max-w-sm max-h-40 whitespace-normal break-words overflow-y-auto overflow-x-hidden",children:U}),operate:P}});return g(n.Fragment,{children:[e("div",{className:`relative w-full h-full ${v??""}`,children:e("div",{className:"absolute w-full h-full overflow-y-auto",children:e(q,{columns:re,data:L()})})}),g(F,{isOpen:y,className:"w-full h-full flex justify-center items-center relative",children:[e("div",{className:"w-full h-full overflow-auto p-6 flex",children:a&&e("a",{href:a==null?void 0:a.src,download:a==null?void 0:a.name,className:"m-auto",onClick:i=>i.preventDefault(),children:e("img",{src:a==null?void 0:a.src,style:{backgroundImage:`linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%),
                linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%)`,backgroundSize:"40px 40px",backgroundPosition:"0 0, 20px 20px"}})})}),e("button",{className:"text-black fixed top-3 right-3",onClick:N,children:e(G,{})})]})]})}function le(){const[l,v]=n.useState([]),[c,o]=n.useState([]),[y,h]=n.useState([]),a=n.useRef(null),[m,f]=n.useState(!1),[N,p]=n.useState(!1),[C,L]=n.useState(!1),[i,u]=n.useState(""),[U,b]=n.useState("blue"),w=(s,d)=>{v(j(t=>{t.splice(d,0,...s)}))},k=s=>{const d=c.findIndex(r=>r[0].md5===s);if(d==-1)return;u(""),b("blue");const t=c[d];t&&(URL.revokeObjectURL(t[1].src),URL.revokeObjectURL(t[1].thumbnail.src),o(j(r=>{r.splice(d,1)})))},M=s=>{const d=l.findIndex(r=>r.md5===s);if(d==-1)return;const t=l[d];URL.revokeObjectURL(t.src),URL.revokeObjectURL(t.thumbnail.src),v(j(r=>{r.splice(d,1)})),k(s)},O=()=>{for(const s of l)URL.revokeObjectURL(s.src),URL.revokeObjectURL(s.thumbnail.src);v([]),P()},P=()=>{for(const s of c)URL.revokeObjectURL(s[1].src),URL.revokeObjectURL(s[1].thumbnail.src);o([]),u(""),b("blue")},I=s=>{L(s)},R=async()=>{try{a.current=new Y,await a.current.initService("steganography");const s=a.current.getPlugins();console.log("plugins",s),s.length&&h(s)}catch(s){console.error(s)}};n.useEffect(()=>(R(),()=>{a.current=null}),[]);const E=async s=>{if(!(!l.length||!a.current)){f(!0),o([]),b("blue");try{console.log("options",s);const d=r=>{u(r.message),r.done&&r.error&&b("red")},t=a.current.processing(l,s,"steganography",d);for await(const r of t)r&&o(j(x=>{x.push(r)}))}catch(d){console.error(d)}finally{f(!1)}}},z=async()=>{if(!(m||N||!c.length)){p(!0);try{const s=c.map(([,{file:d}])=>d);await Z(s,"encrypted-images")}catch(s){console.error(s)}finally{p(!1)}}},S=n.useMemo(()=>m||N||C,[m,N,C]),D=n.useMemo(()=>m||c.length/l.length>0,[l.length,c.length,m]);return e("div",{className:"w-full h-full overflow-auto",children:g("div",{className:"h-full grid grid-rows-[55%_calc(45%_-_0.75rem)] grid-cols-[minmax(300px,auto)_minmax(300px,400px)] gap-3",children:[e("div",{className:"border-2 border-gray-200 rounded-lg p-2",children:e("div",{className:"relative h-full w-full overflow-y-auto overflow-x-hidden",children:e(V,{className:"absolute w-full select-none",list:l,onAdd:w,onRemove:M,disabled:S,onUploadStateChange:I})})}),e("div",{className:"border-2 border-gray-200 rounded-lg p-2",children:e("div",{className:"relative h-full w-full overflow-y-auto overflow-x-hidden",children:e(te,{onStart:E,onClearUpload:O,onClearOutput:P,pluginList:y,className:"absolute w-full select-none",disabled:S})})}),g("div",{className:"flex flex-col col-span-2",children:[e("div",{className:"flex-1 border-2 rounded-lg overflow-hidden",children:e(se,{pairList:c,onRemove:k,disabled:S})}),g("div",{className:`mt-3 flex items-center ${D?"":"hidden"}`,children:[g("div",{className:"p-2 border-2 border-gray-200 shadow-sm rounded-lg flex-1 relative",children:[e("span",{className:"absolute z-10 left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 select-none",children:i}),e(W,{current:c.length,total:l.length,type:"fraction",color:U})]}),e("div",{onClick:z,className:`p-2 border-2 border-gray-200 shadow-sm rounded-lg ml-2 hover:bg-gray-200 ${S?"!bg-gray-100":""}`,children:e(X,{fill:S?"#ccc":"#000",className:"w-4 h-4"})})]})]})]})})}export{le as default};
