(function(){"use strict";var z={},J={get exports(){return z},set exports(S){z=S}};(function(S,L){(function(p){S.exports=p()})(function(p){var v=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];function C(i,n){var t=i[0],e=i[1],a=i[2],r=i[3];t+=(e&a|~e&r)+n[0]-680876936|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[1]-389564586|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[2]+606105819|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[3]-1044525330|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+n[4]-176418897|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[5]+1200080426|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[6]-1473231341|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[7]-45705983|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+n[8]+1770035416|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[9]-1958414417|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[10]-42063|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[11]-1990404162|0,e=(e<<22|e>>>10)+a|0,t+=(e&a|~e&r)+n[12]+1804603682|0,t=(t<<7|t>>>25)+e|0,r+=(t&e|~t&a)+n[13]-40341101|0,r=(r<<12|r>>>20)+t|0,a+=(r&t|~r&e)+n[14]-1502002290|0,a=(a<<17|a>>>15)+r|0,e+=(a&r|~a&t)+n[15]+1236535329|0,e=(e<<22|e>>>10)+a|0,t+=(e&r|a&~r)+n[1]-165796510|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[6]-1069501632|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[11]+643717713|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[0]-373897302|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+n[5]-701558691|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[10]+38016083|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[15]-660478335|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[4]-405537848|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+n[9]+568446438|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[14]-1019803690|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[3]-187363961|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[8]+1163531501|0,e=(e<<20|e>>>12)+a|0,t+=(e&r|a&~r)+n[13]-1444681467|0,t=(t<<5|t>>>27)+e|0,r+=(t&a|e&~a)+n[2]-51403784|0,r=(r<<9|r>>>23)+t|0,a+=(r&e|t&~e)+n[7]+1735328473|0,a=(a<<14|a>>>18)+r|0,e+=(a&t|r&~t)+n[12]-1926607734|0,e=(e<<20|e>>>12)+a|0,t+=(e^a^r)+n[5]-378558|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[8]-2022574463|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[11]+1839030562|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[14]-35309556|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+n[1]-1530992060|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[4]+1272893353|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[7]-155497632|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[10]-1094730640|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+n[13]+681279174|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[0]-358537222|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[3]-722521979|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[6]+76029189|0,e=(e<<23|e>>>9)+a|0,t+=(e^a^r)+n[9]-640364487|0,t=(t<<4|t>>>28)+e|0,r+=(t^e^a)+n[12]-421815835|0,r=(r<<11|r>>>21)+t|0,a+=(r^t^e)+n[15]+530742520|0,a=(a<<16|a>>>16)+r|0,e+=(a^r^t)+n[2]-995338651|0,e=(e<<23|e>>>9)+a|0,t+=(a^(e|~r))+n[0]-198630844|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[7]+1126891415|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[14]-1416354905|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[5]-57434055|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+n[12]+1700485571|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[3]-1894986606|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[10]-1051523|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[1]-2054922799|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+n[8]+1873313359|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[15]-30611744|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[6]-1560198380|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[13]+1309151649|0,e=(e<<21|e>>>11)+a|0,t+=(a^(e|~r))+n[4]-145523070|0,t=(t<<6|t>>>26)+e|0,r+=(e^(t|~a))+n[11]-1120210379|0,r=(r<<10|r>>>22)+t|0,a+=(t^(r|~e))+n[2]+718787259|0,a=(a<<15|a>>>17)+r|0,e+=(r^(a|~t))+n[9]-343485551|0,e=(e<<21|e>>>11)+a|0,i[0]=t+i[0]|0,i[1]=e+i[1]|0,i[2]=a+i[2]|0,i[3]=r+i[3]|0}function B(i){var n=[],t;for(t=0;t<64;t+=4)n[t>>2]=i.charCodeAt(t)+(i.charCodeAt(t+1)<<8)+(i.charCodeAt(t+2)<<16)+(i.charCodeAt(t+3)<<24);return n}function m(i){var n=[],t;for(t=0;t<64;t+=4)n[t>>2]=i[t]+(i[t+1]<<8)+(i[t+2]<<16)+(i[t+3]<<24);return n}function o(i){var n=i.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,M,E,Q;for(e=64;e<=n;e+=64)C(t,B(i.substring(e-64,e)));for(i=i.substring(e-64),a=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=i.charCodeAt(e)<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(C(t,r),e=0;e<16;e+=1)r[e]=0;return M=n*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(M[2],16),Q=parseInt(M[1],16)||0,r[14]=E,r[15]=Q,C(t,r),t}function f(i){var n=i.length,t=[1732584193,-271733879,-1732584194,271733878],e,a,r,M,E,Q;for(e=64;e<=n;e+=64)C(t,m(i.subarray(e-64,e)));for(i=e-64<n?i.subarray(e-64):new Uint8Array(0),a=i.length,r=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e=0;e<a;e+=1)r[e>>2]|=i[e]<<(e%4<<3);if(r[e>>2]|=128<<(e%4<<3),e>55)for(C(t,r),e=0;e<16;e+=1)r[e]=0;return M=n*8,M=M.toString(16).match(/(.*?)(.{0,8})$/),E=parseInt(M[2],16),Q=parseInt(M[1],16)||0,r[14]=E,r[15]=Q,C(t,r),t}function u(i){var n="",t;for(t=0;t<4;t+=1)n+=v[i>>t*8+4&15]+v[i>>t*8&15];return n}function h(i){var n;for(n=0;n<i.length;n+=1)i[n]=u(i[n]);return i.join("")}h(o("hello")),typeof ArrayBuffer<"u"&&!ArrayBuffer.prototype.slice&&function(){function i(n,t){return n=n|0||0,n<0?Math.max(n+t,0):Math.min(n,t)}ArrayBuffer.prototype.slice=function(n,t){var e=this.byteLength,a=i(n,e),r=e,M,E,Q,D;return t!==p&&(r=i(t,e)),a>r?new ArrayBuffer(0):(M=r-a,E=new ArrayBuffer(M),Q=new Uint8Array(E),D=new Uint8Array(this,a,M),Q.set(D),E)}}();function A(i){return/[\u0080-\uFFFF]/.test(i)&&(i=unescape(encodeURIComponent(i))),i}function s(i,n){var t=i.length,e=new ArrayBuffer(t),a=new Uint8Array(e),r;for(r=0;r<t;r+=1)a[r]=i.charCodeAt(r);return n?a:e}function _(i){return String.fromCharCode.apply(null,new Uint8Array(i))}function g(i,n,t){var e=new Uint8Array(i.byteLength+n.byteLength);return e.set(new Uint8Array(i)),e.set(new Uint8Array(n),i.byteLength),t?e:e.buffer}function I(i){var n=[],t=i.length,e;for(e=0;e<t-1;e+=2)n.push(parseInt(i.substr(e,2),16));return String.fromCharCode.apply(String,n)}function l(){this.reset()}return l.prototype.append=function(i){return this.appendBinary(A(i)),this},l.prototype.appendBinary=function(i){this._buff+=i,this._length+=i.length;var n=this._buff.length,t;for(t=64;t<=n;t+=64)C(this._hash,B(this._buff.substring(t-64,t)));return this._buff=this._buff.substring(t-64),this},l.prototype.end=function(i){var n=this._buff,t=n.length,e,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r;for(e=0;e<t;e+=1)a[e>>2]|=n.charCodeAt(e)<<(e%4<<3);return this._finish(a,t),r=h(this._hash),i&&(r=I(r)),this.reset(),r},l.prototype.reset=function(){return this._buff="",this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash.slice()}},l.prototype.setState=function(i){return this._buff=i.buff,this._length=i.length,this._hash=i.hash,this},l.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},l.prototype._finish=function(i,n){var t=n,e,a,r;if(i[t>>2]|=128<<(t%4<<3),t>55)for(C(this._hash,i),t=0;t<16;t+=1)i[t]=0;e=this._length*8,e=e.toString(16).match(/(.*?)(.{0,8})$/),a=parseInt(e[2],16),r=parseInt(e[1],16)||0,i[14]=a,i[15]=r,C(this._hash,i)},l.hash=function(i,n){return l.hashBinary(A(i),n)},l.hashBinary=function(i,n){var t=o(i),e=h(t);return n?I(e):e},l.ArrayBuffer=function(){this.reset()},l.ArrayBuffer.prototype.append=function(i){var n=g(this._buff.buffer,i,!0),t=n.length,e;for(this._length+=i.byteLength,e=64;e<=t;e+=64)C(this._hash,m(n.subarray(e-64,e)));return this._buff=e-64<t?new Uint8Array(n.buffer.slice(e-64)):new Uint8Array(0),this},l.ArrayBuffer.prototype.end=function(i){var n=this._buff,t=n.length,e=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],a,r;for(a=0;a<t;a+=1)e[a>>2]|=n[a]<<(a%4<<3);return this._finish(e,t),r=h(this._hash),i&&(r=I(r)),this.reset(),r},l.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},l.ArrayBuffer.prototype.getState=function(){var i=l.prototype.getState.call(this);return i.buff=_(i.buff),i},l.ArrayBuffer.prototype.setState=function(i){return i.buff=s(i.buff,!0),l.prototype.setState.call(this,i)},l.ArrayBuffer.prototype.destroy=l.prototype.destroy,l.ArrayBuffer.prototype._finish=l.prototype._finish,l.ArrayBuffer.hash=function(i,n){var t=f(new Uint8Array(i)),e=h(t);return n?I(e):e},l})})(J);var N=z;const Z=(S,L)=>{const p=S.split(".");if(p.length<2)return S;const v=p.slice(0,-1).join(".");let C;switch(L){case"image/png":C="png";break;case"image/jpeg":C="jpg";break;case"image/bmp":C="bmp";break;case"image/webp":C="webp";break;default:C=p[p.length-1]}return`${v}.${C}`};function T(S){throw new Error('Could not dynamically require "'+S+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Y={},K={get exports(){return Y},set exports(S){Y=S}};/*!

  pica
  https://github.com/nodeca/pica

  */(function(S,L){(function(p){S.exports=p()})(function(){return function(){function p(v,C,B){function m(u,h){if(!C[u]){if(!v[u]){var A=typeof T=="function"&&T;if(!h&&A)return A(u,!0);if(o)return o(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var _=C[u]={exports:{}};v[u][0].call(_.exports,function(g){var I=v[u][1][g];return m(I||g)},_,_.exports,p,v,C,B)}return C[u].exports}for(var o=typeof T=="function"&&T,f=0;f<B.length;f++)m(B[f]);return m}return p}()({1:[function(p,v,C){var B=p("multimath"),m=p("./mm_unsharp_mask"),o=p("./mm_resize");function f(u){var h=u||[],A={js:h.indexOf("js")>=0,wasm:h.indexOf("wasm")>=0};B.call(this,A),this.features={js:A.js,wasm:A.wasm&&this.has_wasm()},this.use(m),this.use(o)}f.prototype=Object.create(B.prototype),f.prototype.constructor=f,f.prototype.resizeAndUnsharp=function(h,A){var s=this.resize(h,A);return h.unsharpAmount&&this.unsharp_mask(s,h.toWidth,h.toHeight,h.unsharpAmount,h.unsharpRadius,h.unsharpThreshold),s},v.exports=f},{"./mm_resize":4,"./mm_unsharp_mask":9,multimath:19}],2:[function(p,v,C){function B(A){return A<0?0:A>255?255:A}function m(A){return A>=0?A:0}function o(A,s,_,g,I,l){var i,n,t,e,a,r,M,E,Q,D,x,O=0,F=0;for(Q=0;Q<g;Q++){for(a=0,D=0;D<I;D++){for(r=l[a++],M=l[a++],E=O+r*4|0,i=n=t=e=0;M>0;M--)x=l[a++],e=e+x*A[E+3]|0,t=t+x*A[E+2]|0,n=n+x*A[E+1]|0,i=i+x*A[E]|0,E=E+4|0;s[F+3]=m(e>>7),s[F+2]=m(t>>7),s[F+1]=m(n>>7),s[F]=m(i>>7),F=F+g*4|0}F=(Q+1)*4|0,O=(Q+1)*_*4|0}}function f(A,s,_,g,I,l){var i,n,t,e,a,r,M,E,Q,D,x,O=0,F=0;for(Q=0;Q<g;Q++){for(a=0,D=0;D<I;D++){for(r=l[a++],M=l[a++],E=O+r*4|0,i=n=t=e=0;M>0;M--)x=l[a++],e=e+x*A[E+3]|0,t=t+x*A[E+2]|0,n=n+x*A[E+1]|0,i=i+x*A[E]|0,E=E+4|0;i>>=7,n>>=7,t>>=7,e>>=7,s[F+3]=B(e+(1<<13)>>14),s[F+2]=B(t+(1<<13)>>14),s[F+1]=B(n+(1<<13)>>14),s[F]=B(i+(1<<13)>>14),F=F+g*4|0}F=(Q+1)*4|0,O=(Q+1)*_*4|0}}function u(A,s,_,g,I,l){var i,n,t,e,a,r,M,E,Q,D,x,O,F=0,j=0;for(D=0;D<g;D++){for(r=0,x=0;x<I;x++){for(M=l[r++],E=l[r++],Q=F+M*4|0,i=n=t=e=0;E>0;E--)O=l[r++],a=A[Q+3],e=e+O*a|0,t=t+O*A[Q+2]*a|0,n=n+O*A[Q+1]*a|0,i=i+O*A[Q]*a|0,Q=Q+4|0;t=t/255|0,n=n/255|0,i=i/255|0,s[j+3]=m(e>>7),s[j+2]=m(t>>7),s[j+1]=m(n>>7),s[j]=m(i>>7),j=j+g*4|0}j=(D+1)*4|0,F=(D+1)*_*4|0}}function h(A,s,_,g,I,l){var i,n,t,e,a,r,M,E,Q,D,x,O=0,F=0;for(Q=0;Q<g;Q++){for(a=0,D=0;D<I;D++){for(r=l[a++],M=l[a++],E=O+r*4|0,i=n=t=e=0;M>0;M--)x=l[a++],e=e+x*A[E+3]|0,t=t+x*A[E+2]|0,n=n+x*A[E+1]|0,i=i+x*A[E]|0,E=E+4|0;i>>=7,n>>=7,t>>=7,e>>=7,e=B(e+(1<<13)>>14),e>0&&(i=i*255/e|0,n=n*255/e|0,t=t*255/e|0),s[F+3]=e,s[F+2]=B(t+(1<<13)>>14),s[F+1]=B(n+(1<<13)>>14),s[F]=B(i+(1<<13)>>14),F=F+g*4|0}F=(Q+1)*4|0,O=(Q+1)*_*4|0}}v.exports={convolveHor:o,convolveVert:f,convolveHorWithPre:u,convolveVertWithPre:h}},{}],3:[function(p,v,C){v.exports="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"},{}],4:[function(p,v,C){v.exports={name:"resize",fn:p("./resize"),wasm_fn:p("./resize_wasm"),wasm_src:p("./convolve_wasm_base64")}},{"./convolve_wasm_base64":3,"./resize":5,"./resize_wasm":8}],5:[function(p,v,C){var B=p("./resize_filter_gen"),m=p("./convolve"),o=m.convolveHor,f=m.convolveVert,u=m.convolveHorWithPre,h=m.convolveVertWithPre;function A(_,g,I){for(var l=3,i=g*I*4|0;l<i;){if(_[l]!==255)return!0;l=l+4|0}return!1}function s(_,g,I){for(var l=3,i=g*I*4|0;l<i;)_[l]=255,l=l+4|0}v.exports=function(g){var I=g.src,l=g.width,i=g.height,n=g.toWidth,t=g.toHeight,e=g.scaleX||g.toWidth/g.width,a=g.scaleY||g.toHeight/g.height,r=g.offsetX||0,M=g.offsetY||0,E=g.dest||new Uint8Array(n*t*4),Q=typeof g.filter>"u"?"mks2013":g.filter,D=B(Q,l,n,e,r),x=B(Q,i,t,a,M),O=new Uint16Array(n*i*4);return A(I,l,i)?(u(I,O,l,i,n,D),h(O,E,i,n,t,x)):(o(I,O,l,i,n,D),f(O,E,i,n,t,x),s(E,n,t)),E}},{"./convolve":2,"./resize_filter_gen":6}],6:[function(p,v,C){var B=p("./resize_filter_info"),m=14;function o(f){return Math.round(f*((1<<m)-1))}v.exports=function(u,h,A,s,_){var g=B.filter[u].fn,I=1/s,l=Math.min(1,s),i=B.filter[u].win/l,n,t,e,a,r,M,E,Q,D,x,O,F,j,H,c,w,d,y=Math.floor((i+1)*2),b=new Int16Array((y+2)*A),G=0,U=!b.subarray||!b.set;for(n=0;n<A;n++){for(t=(n+.5)*I+_,e=Math.max(0,Math.floor(t-i)),a=Math.min(h-1,Math.ceil(t+i)),r=a-e+1,M=new Float32Array(r),E=new Int16Array(r),Q=0,D=e,x=0;D<=a;D++,x++)O=g((D+.5-t)*l),Q+=O,M[x]=O;for(F=0,x=0;x<M.length;x++)j=M[x]/Q,F+=j,E[x]=o(j);for(E[A>>1]+=o(1-F),H=0;H<E.length&&E[H]===0;)H++;if(H<E.length){for(c=E.length-1;c>0&&E[c]===0;)c--;if(w=e+H,d=c-H+1,b[G++]=w,b[G++]=d,!U)b.set(E.subarray(H,c+1),G),G+=d;else for(x=H;x<=c;x++)b[G++]=E[x]}else b[G++]=0,b[G++]=0}return b}},{"./resize_filter_info":7}],7:[function(p,v,C){var B={box:{win:.5,fn:function(o){return o<0&&(o=-o),o<.5?1:0}},hamming:{win:1,fn:function(o){if(o<0&&(o=-o),o>=1)return 0;if(o<11920929e-14)return 1;var f=o*Math.PI;return Math.sin(f)/f*(.54+.46*Math.cos(f/1))}},lanczos2:{win:2,fn:function(o){if(o<0&&(o=-o),o>=2)return 0;if(o<11920929e-14)return 1;var f=o*Math.PI;return Math.sin(f)/f*Math.sin(f/2)/(f/2)}},lanczos3:{win:3,fn:function(o){if(o<0&&(o=-o),o>=3)return 0;if(o<11920929e-14)return 1;var f=o*Math.PI;return Math.sin(f)/f*Math.sin(f/3)/(f/3)}},mks2013:{win:2.5,fn:function(o){return o<0&&(o=-o),o>=2.5?0:o>=1.5?-.125*(o-2.5)*(o-2.5):o>=.5?.25*(4*o*o-11*o+7):1.0625-1.75*o*o}}};v.exports={filter:B,f2q:{box:0,hamming:1,lanczos2:2,lanczos3:3},q2f:["box","hamming","lanczos2","lanczos3"]}},{}],8:[function(p,v,C){var B=p("./resize_filter_gen");function m(A,s,_){for(var g=3,I=s*_*4|0;g<I;){if(A[g]!==255)return!0;g=g+4|0}return!1}function o(A,s,_){for(var g=3,I=s*_*4|0;g<I;)A[g]=255,g=g+4|0}function f(A){return new Uint8Array(A.buffer,0,A.byteLength)}var u=!0;try{u=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1}catch{}function h(A,s,_){if(u){s.set(f(A),_);return}for(var g=_,I=0;I<A.length;I++){var l=A[I];s[g++]=l&255,s[g++]=l>>8&255}}v.exports=function(s){var _=s.src,g=s.width,I=s.height,l=s.toWidth,i=s.toHeight,n=s.scaleX||s.toWidth/s.width,t=s.scaleY||s.toHeight/s.height,e=s.offsetX||0,a=s.offsetY||0,r=s.dest||new Uint8Array(l*i*4),M=typeof s.filter>"u"?"mks2013":s.filter,E=B(M,g,l,n,e),Q=B(M,I,i,t,a),D=0,x=Math.max(_.byteLength,r.byteLength),O=this.__align(D+x),F=I*l*4*2,j=this.__align(O+F),H=this.__align(j+E.byteLength),c=H+Q.byteLength,w=this.__instance("resize",c),d=new Uint8Array(this.__memory.buffer),y=new Uint32Array(this.__memory.buffer),b=new Uint32Array(_.buffer);y.set(b),h(E,d,j),h(Q,d,H);var G=w.exports.convolveHV||w.exports._convolveHV;m(_,g,I)?G(j,H,O,g,I,l,i,1):(G(j,H,O,g,I,l,i,0),o(r,l,i));var U=new Uint32Array(r.buffer);return U.set(new Uint32Array(this.__memory.buffer,0,i*l)),r}},{"./resize_filter_gen":6}],9:[function(p,v,C){v.exports={name:"unsharp_mask",fn:p("./unsharp_mask"),wasm_fn:p("./unsharp_mask_wasm"),wasm_src:p("./unsharp_mask_wasm_base64")}},{"./unsharp_mask":10,"./unsharp_mask_wasm":11,"./unsharp_mask_wasm_base64":12}],10:[function(p,v,C){var B=p("glur/mono16");function m(o,f,u){for(var h=f*u,A=new Uint16Array(h),s,_,g,I,l=0;l<h;l++)s=o[4*l],_=o[4*l+1],g=o[4*l+2],I=s>=_&&s>=g?s:_>=g&&_>=s?_:g,A[l]=I<<8;return A}v.exports=function(f,u,h,A,s,_){var g,I,l,i,n;if(!(A===0||s<.5)){s>2&&(s=2);var t=m(f,u,h),e=new Uint16Array(t);B(e,u,h,s);for(var a=A/100*4096+.5|0,r=_<<8,M=u*h,E=0;E<M;E++)g=t[E],i=g-e[E],Math.abs(i)>=r&&(I=g+(a*i+2048>>12),I=I>65280?65280:I,I=I<0?0:I,g=g!==0?g:1,l=(I<<12)/g|0,n=E*4,f[n]=f[n]*l+2048>>12,f[n+1]=f[n+1]*l+2048>>12,f[n+2]=f[n+2]*l+2048>>12)}}},{"glur/mono16":18}],11:[function(p,v,C){v.exports=function(m,o,f,u,h,A){if(!(u===0||h<.5)){h>2&&(h=2);var s=o*f,_=s*4,g=s*2,I=s*2,l=Math.max(o,f)*4,i=8*4,n=0,t=_,e=t+g,a=e+I,r=a+I,M=r+l,E=this.__instance("unsharp_mask",_+g+I*2+l+i,{exp:Math.exp}),Q=new Uint32Array(m.buffer),D=new Uint32Array(this.__memory.buffer);D.set(Q);var x=E.exports.hsv_v16||E.exports._hsv_v16;x(n,t,o,f),x=E.exports.blurMono16||E.exports._blurMono16,x(t,e,a,r,M,o,f,h),x=E.exports.unsharp||E.exports._unsharp,x(n,n,t,e,o,f,u,A),Q.set(new Uint32Array(this.__memory.buffer,0,s))}}},{}],12:[function(p,v,C){v.exports="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"},{}],13:[function(p,v,C){var B=100;function m(o,f){this.create=o,this.available=[],this.acquired={},this.lastId=1,this.timeoutId=0,this.idle=f||2e3}m.prototype.acquire=function(){var o=this,f;return this.available.length!==0?f=this.available.pop():(f=this.create(),f.id=this.lastId++,f.release=function(){return o.release(f)}),this.acquired[f.id]=f,f},m.prototype.release=function(o){var f=this;delete this.acquired[o.id],o.lastUsed=Date.now(),this.available.push(o),this.timeoutId===0&&(this.timeoutId=setTimeout(function(){return f.gc()},B))},m.prototype.gc=function(){var o=this,f=Date.now();this.available=this.available.filter(function(u){return f-u.lastUsed>o.idle?(u.destroy(),!1):!0}),this.available.length!==0?this.timeoutId=setTimeout(function(){return o.gc()},B):this.timeoutId=0},v.exports=m},{}],14:[function(p,v,C){var B=2;v.exports=function(o,f,u,h,A,s){var _=u/o,g=h/f,I=(2*s+B+1)/A;if(I>.5)return[[u,h]];var l=Math.ceil(Math.log(Math.min(_,g))/Math.log(I));if(l<=1)return[[u,h]];for(var i=[],n=0;n<l;n++){var t=Math.round(Math.pow(Math.pow(o,l-n-1)*Math.pow(u,n+1),1/l)),e=Math.round(Math.pow(Math.pow(f,l-n-1)*Math.pow(h,n+1),1/l));i.push([t,e])}return i}},{}],15:[function(p,v,C){var B=1e-5;function m(f){var u=Math.round(f);return Math.abs(f-u)<B?u:Math.floor(f)}function o(f){var u=Math.round(f);return Math.abs(f-u)<B?u:Math.ceil(f)}v.exports=function(u){var h=u.toWidth/u.width,A=u.toHeight/u.height,s=m(u.srcTileSize*h)-2*u.destTileBorder,_=m(u.srcTileSize*A)-2*u.destTileBorder;if(s<1||_<1)throw new Error("Internal error in pica: target tile width/height is too small.");var g,I,l,i,n,t,e=[],a;for(i=0;i<u.toHeight;i+=_)for(l=0;l<u.toWidth;l+=s)g=l-u.destTileBorder,g<0&&(g=0),n=l+s+u.destTileBorder-g,g+n>=u.toWidth&&(n=u.toWidth-g),I=i-u.destTileBorder,I<0&&(I=0),t=i+_+u.destTileBorder-I,I+t>=u.toHeight&&(t=u.toHeight-I),a={toX:g,toY:I,toWidth:n,toHeight:t,toInnerX:l,toInnerY:i,toInnerWidth:s,toInnerHeight:_,offsetX:g/h-m(g/h),offsetY:I/A-m(I/A),scaleX:h,scaleY:A,x:m(g/h),y:m(I/A),width:o(n/h),height:o(t/A)},e.push(a);return e}},{}],16:[function(p,v,C){function B(m){return Object.prototype.toString.call(m)}v.exports.isCanvas=function(o){var f=B(o);return f==="[object HTMLCanvasElement]"||f==="[object OffscreenCanvas]"||f==="[object Canvas]"},v.exports.isImage=function(o){return B(o)==="[object HTMLImageElement]"},v.exports.isImageBitmap=function(o){return B(o)==="[object ImageBitmap]"},v.exports.limiter=function(o){var f=0,u=[];function h(){f<o&&u.length&&(f++,u.shift()())}return function(s){return new Promise(function(_,g){u.push(function(){s().then(function(I){_(I),f--,h()},function(I){g(I),f--,h()})}),h()})}},v.exports.cib_quality_name=function(o){switch(o){case 0:return"pixelated";case 1:return"low";case 2:return"medium"}return"high"},v.exports.cib_support=function(o){return Promise.resolve().then(function(){if(typeof createImageBitmap>"u")return!1;var f=o(100,100);return createImageBitmap(f,0,0,100,100,{resizeWidth:10,resizeHeight:10,resizeQuality:"high"}).then(function(u){var h=u.width===10;return u.close(),f=null,h})}).catch(function(){return!1})},v.exports.worker_offscreen_canvas_support=function(){return new Promise(function(o,f){if(typeof OffscreenCanvas>"u"){o(!1);return}function u(s){if(typeof createImageBitmap>"u"){s.postMessage(!1);return}Promise.resolve().then(function(){var _=new OffscreenCanvas(10,10),g=_.getContext("2d");return g.rect(0,0,1,1),createImageBitmap(_,0,0,1,1)}).then(function(){return s.postMessage(!0)},function(){return s.postMessage(!1)})}var h=btoa("(".concat(u.toString(),")(self);")),A=new Worker("data:text/javascript;base64,".concat(h));A.onmessage=function(s){return o(s.data)},A.onerror=f}).then(function(o){return o},function(){return!1})},v.exports.can_use_canvas=function(o){var f=!1;try{var u=o(2,1),h=u.getContext("2d"),A=h.createImageData(2,1);A.data[0]=12,A.data[1]=23,A.data[2]=34,A.data[3]=255,A.data[4]=45,A.data[5]=56,A.data[6]=67,A.data[7]=255,h.putImageData(A,0,0),A=null,A=h.getImageData(0,0,2,1),A.data[0]===12&&A.data[1]===23&&A.data[2]===34&&A.data[3]===255&&A.data[4]===45&&A.data[5]===56&&A.data[6]===67&&A.data[7]===255&&(f=!0)}catch{}return f},v.exports.cib_can_use_region=function(){return new Promise(function(o){if(typeof Image>"u"||typeof createImageBitmap>"u"){o(!1);return}var f=new Image;f.src="data:image/jpeg;base64,/9j/4QBiRXhpZgAATU0AKgAAAAgABQESAAMAAAABAAYAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAAITAAMAAAABAAEAAAAAAAAAAABIAAAAAQAAAEgAAAAB/9sAQwAEAwMEAwMEBAMEBQQEBQYKBwYGBgYNCQoICg8NEBAPDQ8OERMYFBESFxIODxUcFRcZGRsbGxAUHR8dGh8YGhsa/9sAQwEEBQUGBQYMBwcMGhEPERoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoa/8IAEQgAAQACAwERAAIRAQMRAf/EABQAAQAAAAAAAAAAAAAAAAAAAAf/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAF/P//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAQUCf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Bf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Bf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEABj8Cf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8hf//aAAwDAQACAAMAAAAQH//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQMBAT8Qf//EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQIBAT8Qf//EABQQAQAAAAAAAAAAAAAAAAAAAAD/2gAIAQEAAT8Qf//Z",f.onload=function(){createImageBitmap(f,0,0,f.width,f.height).then(function(u){u.width===f.width&&u.height===f.height?o(!0):o(!1)},function(){return o(!1)})},f.onerror=function(){return o(!1)}})}},{}],17:[function(p,v,C){v.exports=function(){var B=p("./mathlib"),m;onmessage=function(f){var u=f.data.opts;if(!u.src&&u.srcBitmap){var h=new OffscreenCanvas(u.width,u.height),A=h.getContext("2d");A.drawImage(u.srcBitmap,0,0),u.src=A.getImageData(0,0,u.width,u.height).data,h.width=h.height=0,h=null,u.srcBitmap.close(),u.srcBitmap=null}m||(m=new B(f.data.features));var s=m.resizeAndUnsharp(u);postMessage({data:s},[s.buffer])}}},{"./mathlib":1}],18:[function(p,v,C){var B,m,o,f,u,h,A,s;function _(l){l<.5&&(l=.5);var i=Math.exp(.726*.726)/l,n=Math.exp(-i),t=Math.exp(-2*i),e=(1-n)*(1-n)/(1+2*i*n-t);return B=e,m=e*(i-1)*n,o=e*(i+1)*n,f=-e*t,u=2*n,h=-t,A=(B+m)/(1-u-h),s=(o+f)/(1-u-h),new Float32Array([B,m,o,f,u,h,A,s])}function g(l,i,n,t,e,a){var r,M,E,Q,D,x,O,F,j,H,c,w,d,y;for(j=0;j<a;j++){for(x=j*e,O=j,F=0,r=l[x],D=r*t[6],Q=D,c=t[0],w=t[1],d=t[4],y=t[5],H=0;H<e;H++)M=l[x],E=M*c+r*w+Q*d+D*y,D=Q,Q=E,r=M,n[F]=Q,F++,x++;for(x--,F--,O+=a*(e-1),r=l[x],D=r*t[7],Q=D,M=r,c=t[2],w=t[3],H=e-1;H>=0;H--)E=M*c+r*w+Q*d+D*y,D=Q,Q=E,r=M,M=l[x],i[O]=n[F]+Q,x--,F--,O-=a}}function I(l,i,n,t){if(t){var e=new Uint16Array(l.length),a=new Float32Array(Math.max(i,n)),r=_(t);g(l,e,a,r,i,n),g(e,l,a,r,n,i)}}v.exports=I},{}],19:[function(p,v,C){var B=p("object-assign"),m=p("./lib/base64decode"),o=p("./lib/wa_detect"),f={js:!0,wasm:!0};function u(h){if(!(this instanceof u))return new u(h);var A=B({},f,h||{});if(this.options=A,this.__cache={},this.__init_promise=null,this.__modules=A.modules||{},this.__memory=null,this.__wasm={},this.__isLE=new Uint32Array(new Uint8Array([1,0,0,0]).buffer)[0]===1,!this.options.js&&!this.options.wasm)throw new Error('mathlib: at least "js" or "wasm" should be enabled')}u.prototype.has_wasm=o,u.prototype.use=function(h){return this.__modules[h.name]=h,this.options.wasm&&this.has_wasm()&&h.wasm_fn?this[h.name]=h.wasm_fn:this[h.name]=h.fn,this},u.prototype.init=function(){if(this.__init_promise)return this.__init_promise;if(!this.options.js&&this.options.wasm&&!this.has_wasm())return Promise.reject(new Error(`mathlib: only "wasm" was enabled, but it's not supported`));var h=this;return this.__init_promise=Promise.all(Object.keys(h.__modules).map(function(A){var s=h.__modules[A];return!h.options.wasm||!h.has_wasm()||!s.wasm_fn||h.__wasm[A]?null:WebAssembly.compile(h.__base64decode(s.wasm_src)).then(function(_){h.__wasm[A]=_})})).then(function(){return h}),this.__init_promise},u.prototype.__base64decode=m,u.prototype.__reallocate=function(A){if(!this.__memory)return this.__memory=new WebAssembly.Memory({initial:Math.ceil(A/(64*1024))}),this.__memory;var s=this.__memory.buffer.byteLength;return s<A&&this.__memory.grow(Math.ceil((A-s)/(64*1024))),this.__memory},u.prototype.__instance=function(A,s,_){if(s&&this.__reallocate(s),!this.__wasm[A]){var g=this.__modules[A];this.__wasm[A]=new WebAssembly.Module(this.__base64decode(g.wasm_src))}if(!this.__cache[A]){var I={memoryBase:0,memory:this.__memory,tableBase:0,table:new WebAssembly.Table({initial:0,element:"anyfunc"})};this.__cache[A]=new WebAssembly.Instance(this.__wasm[A],{env:B(I,_||{})})}return this.__cache[A]},u.prototype.__align=function(A,s){s=s||8;var _=A%s;return A+(_?s-_:0)},v.exports=u},{"./lib/base64decode":20,"./lib/wa_detect":21,"object-assign":22}],20:[function(p,v,C){var B="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";v.exports=function(o){for(var f=o.replace(/[\r\n=]/g,""),u=f.length,h=new Uint8Array(u*3>>2),A=0,s=0,_=0;_<u;_++)_%4===0&&_&&(h[s++]=A>>16&255,h[s++]=A>>8&255,h[s++]=A&255),A=A<<6|B.indexOf(f.charAt(_));var g=u%4*6;return g===0?(h[s++]=A>>16&255,h[s++]=A>>8&255,h[s++]=A&255):g===18?(h[s++]=A>>10&255,h[s++]=A>>2&255):g===12&&(h[s++]=A>>4&255),h}},{}],21:[function(p,v,C){var B;v.exports=function(){if(typeof B<"u"||(B=!1,typeof WebAssembly>"u"))return B;try{var o=new Uint8Array([0,97,115,109,1,0,0,0,1,6,1,96,1,127,1,127,3,2,1,0,5,3,1,0,1,7,8,1,4,116,101,115,116,0,0,10,16,1,14,0,32,0,65,1,54,2,0,32,0,40,2,0,11]),f=new WebAssembly.Module(o),u=new WebAssembly.Instance(f,{});return u.exports.test(4)!==0&&(B=!0),B}catch{}return B}},{}],22:[function(p,v,C){var B=Object.getOwnPropertySymbols,m=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable;function f(h){if(h==null)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(h)}function u(){try{if(!Object.assign)return!1;var h=new String("abc");if(h[5]="de",Object.getOwnPropertyNames(h)[0]==="5")return!1;for(var A={},s=0;s<10;s++)A["_"+String.fromCharCode(s)]=s;var _=Object.getOwnPropertyNames(A).map(function(I){return A[I]});if(_.join("")!=="0123456789")return!1;var g={};return"abcdefghijklmnopqrst".split("").forEach(function(I){g[I]=I}),Object.keys(Object.assign({},g)).join("")==="abcdefghijklmnopqrst"}catch{return!1}}v.exports=u()?Object.assign:function(h,A){for(var s,_=f(h),g,I=1;I<arguments.length;I++){s=Object(arguments[I]);for(var l in s)m.call(s,l)&&(_[l]=s[l]);if(B){g=B(s);for(var i=0;i<g.length;i++)o.call(s,g[i])&&(_[g[i]]=s[g[i]])}}return _}},{}],23:[function(p,v,C){var B=arguments[3],m=arguments[4],o=arguments[5],f=JSON.stringify;v.exports=function(u,h){for(var A,s=Object.keys(o),_=0,g=s.length;_<g;_++){var I=s[_],l=o[I].exports;if(l===u||l&&l.default===u){A=I;break}}if(!A){A=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var i={},_=0,g=s.length;_<g;_++){var I=s[_];i[I]=I}m[A]=["function(require,module,exports){"+u+"(self); }",i]}var n=Math.floor(Math.pow(16,8)*Math.random()).toString(16),t={};t[A]=A,m[n]=["function(require,module,exports){var f = require("+f(A)+");(f.default ? f.default : f)(self);}",t];var e={};a(n);function a(x){e[x]=!0;for(var O in m[x][1]){var F=m[x][1][O];e[F]||a(F)}}var r="("+B+")({"+Object.keys(e).map(function(x){return f(x)+":["+m[x][0]+","+f(m[x][1])+"]"}).join(",")+"},{},["+f(n)+"])",M=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([r],{type:"text/javascript"});if(h&&h.bare)return E;var Q=M.createObjectURL(E),D=new Worker(Q);return D.objectURL=Q,D}},{}],"/index.js":[function(p,v,C){function B(c,w){return h(c)||u(c,w)||o(c,w)||m()}function m(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function o(c,w){if(c){if(typeof c=="string")return f(c,w);var d=Object.prototype.toString.call(c).slice(8,-1);if(d==="Object"&&c.constructor&&(d=c.constructor.name),d==="Map"||d==="Set")return Array.from(c);if(d==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(d))return f(c,w)}}function f(c,w){(w==null||w>c.length)&&(w=c.length);for(var d=0,y=new Array(w);d<w;d++)y[d]=c[d];return y}function u(c,w){var d=c==null?null:typeof Symbol<"u"&&c[Symbol.iterator]||c["@@iterator"];if(d!=null){var y=[],b=!0,G=!1,U,R;try{for(d=d.call(c);!(b=(U=d.next()).done)&&(y.push(U.value),!(w&&y.length===w));b=!0);}catch(P){G=!0,R=P}finally{try{!b&&d.return!=null&&d.return()}finally{if(G)throw R}}return y}}function h(c){if(Array.isArray(c))return c}var A=p("object-assign"),s=p("webworkify"),_=p("./lib/mathlib"),g=p("./lib/pool"),I=p("./lib/utils"),l=p("./lib/worker"),i=p("./lib/stepper"),n=p("./lib/tiler"),t=p("./lib/mm_resize/resize_filter_info"),e={},a=!1;try{typeof navigator<"u"&&navigator.userAgent&&(a=navigator.userAgent.indexOf("Safari")>=0)}catch{}var r=1;typeof navigator<"u"&&(r=Math.min(navigator.hardwareConcurrency||1,4));var M={tile:1024,concurrency:r,features:["js","wasm","ww"],idle:2e3,createCanvas:function(w,d){var y=document.createElement("canvas");return y.width=w,y.height=d,y}},E={filter:"mks2013",unsharpAmount:0,unsharpRadius:0,unsharpThreshold:0},Q=!1,D=!1,x=!1,O=!1,F=!1;function j(){return{value:s(l),destroy:function(){if(this.value.terminate(),typeof window<"u"){var w=window.URL||window.webkitURL||window.mozURL||window.msURL;w&&w.revokeObjectURL&&this.value.objectURL&&w.revokeObjectURL(this.value.objectURL)}}}}function H(c){if(!(this instanceof H))return new H(c);this.options=A({},M,c||{});var w="lk_".concat(this.options.concurrency);this.__limit=e[w]||I.limiter(this.options.concurrency),e[w]||(e[w]=this.__limit),this.features={js:!1,wasm:!1,cib:!1,ww:!1},this.__workersPool=null,this.__requested_features=[],this.__mathlib=null}H.prototype.init=function(){var c=this;if(this.__initPromise)return this.__initPromise;if(typeof ImageData<"u"&&typeof Uint8ClampedArray<"u")try{new ImageData(new Uint8ClampedArray(400),10,10),Q=!0}catch{}typeof ImageBitmap<"u"&&(ImageBitmap.prototype&&ImageBitmap.prototype.close?D=!0:this.debug("ImageBitmap does not support .close(), disabled"));var w=this.options.features.slice();if(w.indexOf("all")>=0&&(w=["cib","wasm","js","ww"]),this.__requested_features=w,this.__mathlib=new _(w),w.indexOf("ww")>=0&&typeof window<"u"&&"Worker"in window)try{var d=p("webworkify")(function(){});d.terminate(),this.features.ww=!0;var y="wp_".concat(JSON.stringify(this.options));e[y]?this.__workersPool=e[y]:(this.__workersPool=new g(j,this.options.idle),e[y]=this.__workersPool)}catch{}var b=this.__mathlib.init().then(function(P){A(c.features,P.features)}),G;D?G=I.cib_support(this.options.createCanvas).then(function(P){if(c.features.cib&&w.indexOf("cib")<0){c.debug("createImageBitmap() resize supported, but disabled by config");return}w.indexOf("cib")>=0&&(c.features.cib=P)}):G=Promise.resolve(!1),x=I.can_use_canvas(this.options.createCanvas);var U;D&&Q&&w.indexOf("ww")!==-1?U=I.worker_offscreen_canvas_support():U=Promise.resolve(!1),U=U.then(function(P){O=P});var R=I.cib_can_use_region().then(function(P){F=P});return this.__initPromise=Promise.all([b,G,U,R]).then(function(){return c}),this.__initPromise},H.prototype.__invokeResize=function(c,w){var d=this;return w.__mathCache=w.__mathCache||{},Promise.resolve().then(function(){return d.features.ww?new Promise(function(y,b){var G=d.__workersPool.acquire();w.cancelToken&&w.cancelToken.catch(function(R){return b(R)}),G.value.onmessage=function(R){G.release(),R.data.err?b(R.data.err):y(R.data)};var U=[];c.src&&U.push(c.src.buffer),c.srcBitmap&&U.push(c.srcBitmap),G.value.postMessage({opts:c,features:d.__requested_features,preload:{wasm_nodule:d.__mathlib.__}},U)}):{data:d.__mathlib.resizeAndUnsharp(c,w.__mathCache)}})},H.prototype.__extractTileData=function(c,w,d,y,b){if(this.features.ww&&O&&(I.isCanvas(w)||F))return this.debug("Create tile for OffscreenCanvas"),createImageBitmap(y.srcImageBitmap||w,c.x,c.y,c.width,c.height).then(function(R){return b.srcBitmap=R,b});if(I.isCanvas(w))return y.srcCtx||(y.srcCtx=w.getContext("2d")),this.debug("Get tile pixel data"),b.src=y.srcCtx.getImageData(c.x,c.y,c.width,c.height).data,b;this.debug("Draw tile imageBitmap/image to temporary canvas");var G=this.options.createCanvas(c.width,c.height),U=G.getContext("2d");return U.globalCompositeOperation="copy",U.drawImage(y.srcImageBitmap||w,c.x,c.y,c.width,c.height,0,0,c.width,c.height),this.debug("Get tile pixel data"),b.src=U.getImageData(0,0,c.width,c.height).data,G.width=G.height=0,b},H.prototype.__landTileData=function(c,w,d){var y;if(this.debug("Convert raw rgba tile result to ImageData"),w.bitmap)return d.toCtx.drawImage(w.bitmap,c.toX,c.toY),null;if(Q)y=new ImageData(new Uint8ClampedArray(w.data),c.toWidth,c.toHeight);else if(y=d.toCtx.createImageData(c.toWidth,c.toHeight),y.data.set)y.data.set(w.data);else for(var b=y.data.length-1;b>=0;b--)y.data[b]=w.data[b];return this.debug("Draw tile"),a?d.toCtx.putImageData(y,c.toX,c.toY,c.toInnerX-c.toX,c.toInnerY-c.toY,c.toInnerWidth+1e-5,c.toInnerHeight+1e-5):d.toCtx.putImageData(y,c.toX,c.toY,c.toInnerX-c.toX,c.toInnerY-c.toY,c.toInnerWidth,c.toInnerHeight),null},H.prototype.__tileAndResize=function(c,w,d){var y=this,b={srcCtx:null,srcImageBitmap:null,isImageBitmapReused:!1,toCtx:null},G=function(R){return y.__limit(function(){if(d.canceled)return d.cancelToken;var P={width:R.width,height:R.height,toWidth:R.toWidth,toHeight:R.toHeight,scaleX:R.scaleX,scaleY:R.scaleY,offsetX:R.offsetX,offsetY:R.offsetY,filter:d.filter,unsharpAmount:d.unsharpAmount,unsharpRadius:d.unsharpRadius,unsharpThreshold:d.unsharpThreshold};return y.debug("Invoke resize math"),Promise.resolve(P).then(function(k){return y.__extractTileData(R,c,d,b,k)}).then(function(k){return y.debug("Invoke resize math"),y.__invokeResize(k,d)}).then(function(k){return d.canceled?d.cancelToken:(b.srcImageData=null,y.__landTileData(R,k,b))})})};return Promise.resolve().then(function(){if(b.toCtx=w.getContext("2d"),I.isCanvas(c))return null;if(I.isImageBitmap(c))return b.srcImageBitmap=c,b.isImageBitmapReused=!0,null;if(I.isImage(c))return D?(y.debug("Decode image via createImageBitmap"),createImageBitmap(c).then(function(U){b.srcImageBitmap=U}).catch(function(U){return null})):null;throw new Error('Pica: ".from" should be Image, Canvas or ImageBitmap')}).then(function(){if(d.canceled)return d.cancelToken;y.debug("Calculate tiles");var U=n({width:d.width,height:d.height,srcTileSize:y.options.tile,toWidth:d.toWidth,toHeight:d.toHeight,destTileBorder:d.__destTileBorder}),R=U.map(function(k){return G(k)});function P(k){k.srcImageBitmap&&(k.isImageBitmapReused||k.srcImageBitmap.close(),k.srcImageBitmap=null)}return y.debug("Process tiles"),Promise.all(R).then(function(){return y.debug("Finished!"),P(b),w},function(k){throw P(b),k})})},H.prototype.__processStages=function(c,w,d,y){var b=this;if(y.canceled)return y.cancelToken;var G=c.shift(),U=B(G,2),R=U[0],P=U[1],k=c.length===0,q;k||t.q2f.indexOf(y.filter)<0?q=y.filter:y.filter==="box"?q="box":q="hamming",y=A({},y,{toWidth:R,toHeight:P,filter:q});var W;return k||(W=this.options.createCanvas(R,P)),this.__tileAndResize(w,k?d:W,y).then(function(){return k?d:(y.width=R,y.height=P,b.__processStages(c,W,d,y))}).then(function(oe){return W&&(W.width=W.height=0),oe})},H.prototype.__resizeViaCreateImageBitmap=function(c,w,d){var y=this,b=w.getContext("2d");return this.debug("Resize via createImageBitmap()"),createImageBitmap(c,{resizeWidth:d.toWidth,resizeHeight:d.toHeight,resizeQuality:I.cib_quality_name(t.f2q[d.filter])}).then(function(G){if(d.canceled)return d.cancelToken;if(!d.unsharpAmount)return b.drawImage(G,0,0),G.close(),b=null,y.debug("Finished!"),w;y.debug("Unsharp result");var U=y.options.createCanvas(d.toWidth,d.toHeight),R=U.getContext("2d");R.drawImage(G,0,0),G.close();var P=R.getImageData(0,0,d.toWidth,d.toHeight);return y.__mathlib.unsharp_mask(P.data,d.toWidth,d.toHeight,d.unsharpAmount,d.unsharpRadius,d.unsharpThreshold),b.putImageData(P,0,0),U.width=U.height=0,P=R=U=b=null,y.debug("Finished!"),w})},H.prototype.resize=function(c,w,d){var y=this;this.debug("Start resize...");var b=A({},E);if(isNaN(d)?d&&(b=A(b,d)):b=A(b,{quality:d}),b.toWidth=w.width,b.toHeight=w.height,b.width=c.naturalWidth||c.width,b.height=c.naturalHeight||c.height,Object.prototype.hasOwnProperty.call(b,"quality")){if(b.quality<0||b.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(b.quality));b.filter=t.q2f[b.quality]}if(w.width===0||w.height===0)return Promise.reject(new Error("Invalid output size: ".concat(w.width,"x").concat(w.height)));b.unsharpRadius>2&&(b.unsharpRadius=2),b.canceled=!1,b.cancelToken&&(b.cancelToken=b.cancelToken.then(function(U){throw b.canceled=!0,U},function(U){throw b.canceled=!0,U}));var G=3;return b.__destTileBorder=Math.ceil(Math.max(G,2.5*b.unsharpRadius|0)),this.init().then(function(){if(b.canceled)return b.cancelToken;if(y.features.cib){if(t.q2f.indexOf(b.filter)>=0)return y.__resizeViaCreateImageBitmap(c,w,b);y.debug("cib is enabled, but not supports provided filter, fallback to manual math")}if(!x){var U=new Error("Pica: cannot use getImageData on canvas, make sure fingerprinting protection isn't enabled");throw U.code="ERR_GET_IMAGE_DATA",U}var R=i(b.width,b.height,b.toWidth,b.toHeight,y.options.tile,b.__destTileBorder);return y.__processStages(R,c,w,b)})},H.prototype.resizeBuffer=function(c){var w=this,d=A({},E,c);if(Object.prototype.hasOwnProperty.call(d,"quality")){if(d.quality<0||d.quality>3)throw new Error("Pica: .quality should be [0..3], got ".concat(d.quality));d.filter=t.q2f[d.quality]}return this.init().then(function(){return w.__mathlib.resizeAndUnsharp(d)})},H.prototype.toBlob=function(c,w,d){return w=w||"image/png",new Promise(function(y){if(c.toBlob){c.toBlob(function(P){return y(P)},w,d);return}if(c.convertToBlob){y(c.convertToBlob({type:w,quality:d}));return}for(var b=atob(c.toDataURL(w,d).split(",")[1]),G=b.length,U=new Uint8Array(G),R=0;R<G;R++)U[R]=b.charCodeAt(R);y(new Blob([U],{type:w}))})},H.prototype.debug=function(){},v.exports=H},{"./lib/mathlib":1,"./lib/mm_resize/resize_filter_info":7,"./lib/pool":13,"./lib/stepper":14,"./lib/tiler":15,"./lib/utils":16,"./lib/worker":17,"object-assign":22,webworkify:23}]},{},[])("/index.js")})})(K);var V=Y;function $(S,L){const p=S.size,v=1024*1024*10;return p<=v?new Promise(C=>{const B=new FileReader;B.readAsArrayBuffer(S),B.onload=m=>{var u;const o=new N.ArrayBuffer;o.append((u=m.target)==null?void 0:u.result);const f=o.end();C(f)}}):new Promise(C=>{const B=Math.ceil(p/v);let m=0,o=0;const f=new N.ArrayBuffer,u=new FileReader;u.onload=function(A){var s;if(f.append((s=A.target)==null?void 0:s.result),o+=v,m++,m<B)h();else{const _=f.end();C(_)}if(L){const _=Math.min(o/p*100,100);L(_)}};function h(){const A=o,s=Math.min(A+v,p);u.readAsArrayBuffer(S.slice(A,s))}h()})}async function ee(S,L=1){const p=await createImageBitmap(S),v=new OffscreenCanvas(p.width,p.height),C=v.getContext("2d");if(C.drawImage(p,0,0),L<1){const m=await v.convertToBlob({type:"image/jpeg",quality:L}),o=await createImageBitmap(m);C.clearRect(0,0,v.width,v.height),C.drawImage(o,0,0)}const B=C.getImageData(0,0,p.width,p.height).data.buffer;return{name:S.name,buffer:B,width:p.width,height:p.height}}async function te(S,L="image/png",p=1){const{buffer:v,width:C,height:B,name:m}=S,o=new ImageData(new Uint8ClampedArray(v),C,B),f=new OffscreenCanvas(C,B);f.getContext("2d").putImageData(o,0,0);const h=await f.convertToBlob({type:L,quality:p}),A=Z(m,h.type);return new File([h],`encrypted-${A}`,{type:h.type})}const re=S=>new Promise((L,p)=>{const v=new Image;v.src=URL.createObjectURL(S),v.onload=()=>{URL.revokeObjectURL(v.src),L(v)},v.onerror=()=>{URL.revokeObjectURL(v.src),p(new Error("Failed to load image"))}}),ae=async(S,L,p,v)=>{try{const C=new V({createCanvas:(u,h)=>new OffscreenCanvas(u,h)}),B=v?await createImageBitmap(S):await re(S),m=Math.min(L/B.width,p/B.height),o=new OffscreenCanvas(B.width*m,B.height*m);await C.resize(B,o);const f=await o.convertToBlob({type:"image/png"});return new File([f],S.name,{type:f.type})}catch(C){return console.error("生成缩略图失败: ",C),S}},ne=async(S,L,p=!0,v=!1,C=128,B=128)=>{const m=await ae(S,C,B,v),o=L||await $(S),f=p?URL.createObjectURL(S):"",u=p?URL.createObjectURL(m):"";return{file:S,src:f,md5:o,thumbnail:{file:m,src:u}}},ie=S=>{const L=new Uint8Array(S),v=new TextDecoder("utf-8").decode(L);return new Function(`return ${v}`)()};let X=null;const Ae=async(S,L,p={})=>{const v=await ee(S.file),{format:C,quality:B,...m}=p,o=await X(v,L,m),f=await te(o.data,C,B),u=await ne(f,null,!1,!0),h=o.payload;return{data:u,payload:h}};self.addEventListener("message",async S=>{const{args:L,func:p}=S.data;if(p)X=ie(p);else if(L)try{const v=await Ae(...L);self.postMessage(v)}catch(v){console.error("图像处理失败: ",v),self.postMessage(null)}})})();
