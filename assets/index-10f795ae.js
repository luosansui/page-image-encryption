import{r as a,j as f,a as e,f as K}from"./index-d483e458.js";import{L as Q,C as G,B as $,c as F,T as J,a as W,S as H,g as V,b as _,s as X,U as Y,P as Z,d as ee,f as M,I as te,m as se}from"./zip-3b3435a7.js";const ae=[{title:"加密图像",description:"使用本算法加密所有图像"},{title:"解密图像",description:"使用本算法解密所有图像"}],q=[{label:"源格式",value:""},{label:"PNG",value:"image/png"},{label:"JPEG",value:"image/jpeg"},{label:"BMP",value:"image/bmp"},{label:"WEBP",value:"image/webp"}],T=o=>f("div",{className:"flex items-center mb-4 relative",children:[e("div",{className:"w-[64px] mr-3 whitespace-nowrap text-justify relative",style:{textAlignLast:"justify"},children:o.label}),o.children,o.message&&e("span",{className:"absolute ml-[32px] -bottom-[2px] left-1/2 -translate-x-1/2 translate-y-full text-xs text-red-400",children:o.message})]});function ne({onStart:o,className:y,pluginList:m,disabled:c,onClearUpload:N,onClearOutput:b}){const[l,p]=a.useState(0),[x,w]=a.useState("encrypt"),[v,L]=a.useState(""),[I,r]=a.useState(""),[i,O]=a.useState(0),[g,k]=a.useState(100),[P,j]=a.useState(!1),S=(t,n)=>n!=null&&n.required&&t===""?(r("秘钥不能为空"),!1):n!=null&&n.required&&(n!=null&&n.regex)&&!new RegExp(n.regex).test(t)?(r(n.message),!1):(r(""),!0),U=()=>{const t=m[l];S(v,t.keyRule)&&(o==null||o({pluginName:t.name,optionName:x,key:v,format:q[i].value,quality:g/100}))},E=t=>{p(t)},R=t=>{w(["encrypt","decrypt"][t])},z=t=>{const n=parseInt(t.target.value);!isNaN(n)&&n>=0&&n<=100&&k(n)},D=t=>{O(t)},C=t=>{const n=t.target.value;L(n);const B=m[l];S(n,B==null?void 0:B.keyRule)},A=()=>{N==null||N()},s=()=>{b==null||b()},d=t=>t.name??"未载入算法",h=t=>f(a.Fragment,{children:[e("div",{className:"font-semibold",children:t.name}),e("div",{className:"text-xs truncate my-1",children:t.description}),f("div",{className:"flex justify-between text-xs ",children:[e("span",{className:"text-gray-500",children:F(t.language)}),e("span",{className:"text-gray-400",children:t.version})]})]});a.useEffect(()=>{const t=q[i].value,n=t!=="image/jpeg"&&t!=="image/webp"&&t!=="";n&&k(100),j(n)},[i]);const u=a.useMemo(()=>g===100?"无损":g===0?"最低":`${g}%`,[g]);return f("div",{className:`text-gray-600 p-3 ${y??""}`,children:[e(Q,{options:m,checkedIndex:l,disabled:c,onChange:E,renderSelected:d,renderList:h,className:"mb-4"}),e(G,{options:ae,disabled:c,onChange:R,className:"mb-4"}),e(T,{label:"秘钥",message:I,children:e("input",{type:"text",value:v,disabled:c,onChange:C,className:`${c?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),e(T,{label:"文件格式",children:e(Q,{options:q,checkedIndex:i,disabled:c,onChange:D,renderSelected:t=>t.label,renderList:t=>t.label,className:"flex-1",listNumber:3})}),e(T,{label:"图像质量",children:f("div",{className:"flex-1 relative",children:[e("input",{type:"range",min:"0",max:"100",value:g,disabled:c||P,onChange:z,className:"absolute w-[80%]"}),e("span",{className:"whitespace-nowrap text-sm ml-1 w-[20%] text-center float-right",children:u})]})}),f("div",{className:"text-center pt-2",children:[e($,{disabled:c,onClick:A,typeColor:"white",className:"mb-2 mr-2",children:"清空上传"}),e($,{disabled:c,onClick:s,typeColor:"white",className:"mb-2 mr-2",children:"清空输出"}),f($,{onClick:U,disabled:c,className:"mb-2",children:["开始",x==="encrypt"?"加密":"解密"]})]})]})}const re=[{title:"原图",key:"origin"},{title:"生成图",key:"current"},{title:"原图大小",key:"originSize"},{title:"生成图大小",key:"currentSize"},{title:"压缩率",key:"compressionRatio"},{title:"操作",key:"operate"}];function le({pairList:o,className:y,disabled:m,onRemove:c}){const[N,b]=a.useState(!1),[l,p]=a.useState(null),x=(r,i)=>{b(!0),p({src:r,name:i})},w=()=>{b(!1),p(null)},v=r=>{m||c==null||c(r)},L=({file:r})=>{m||X(r,r.name)},I=()=>Array.from(o,([r,i])=>{const O=r.md5,g=e(_,{file:r,onClick:()=>x(r.src,r.file.name)}),k=e(_,{file:i,onClick:()=>x(i.src,i.file.name)}),P=K(r.file.size,"MB"),j=K(i.file.size,"MB"),S=V(r.file,i.file),U=f("div",{children:[e("span",{onClick:()=>L(i),className:"cursor-pointer select-none text-blue-500 font-semibold text-sm underline underline-offset-2 mx-2",children:"下载"}),e("span",{onClick:()=>v(r.md5),className:"cursor-pointer select-none text-red-500 font-semibold text-sm underline underline-offset-2 mx-2",children:"删除"})]});return{id:O,origin:g,current:k,originSize:P,currentSize:j,compressionRatio:f("span",{className:`${S>100?"text-red-500":"text-green-500"}`,children:[S,"%"]}),operate:U}});return f(a.Fragment,{children:[e("div",{className:`relative w-full h-full ${y??""}`,children:e("div",{className:"absolute w-full h-full overflow-y-auto",children:e(J,{columns:re,data:I()})})}),f(W,{isOpen:N,className:"w-full h-full flex justify-center items-center relative",children:[e("div",{className:"w-full h-full overflow-auto p-6 flex",children:l&&e("a",{href:l==null?void 0:l.src,download:l==null?void 0:l.name,className:"m-auto",onClick:r=>r.preventDefault(),children:e("img",{src:l==null?void 0:l.src,style:{backgroundImage:`linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%),
                linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%)`,backgroundSize:"40px 40px",backgroundPosition:"0 0, 20px 20px"}})})}),e("button",{className:"text-black fixed top-3 right-3",onClick:w,children:e(H,{})})]})]})}function ie(){const[o,y]=a.useState([]),[m,c]=a.useState([]),[N,b]=a.useState([]),l=a.useRef(null),[p,x]=a.useState(!1),[w,v]=a.useState(!1),[L,I]=a.useState(!1),[r,i]=a.useState(""),[O,g]=a.useState("blue"),k=(s,d)=>{y(M(h=>{h.splice(d,0,...s)}))},P=s=>{const d=m.findIndex(u=>u[0].md5===s);if(d==-1)return;i(""),g("blue");const h=m[d];h&&(URL.revokeObjectURL(h[1].src),URL.revokeObjectURL(h[1].thumbnail.src),c(M(u=>{u.splice(d,1)})))},j=s=>{const d=o.findIndex(u=>u.md5===s);if(d==-1)return;const h=o[d];URL.revokeObjectURL(h.src),URL.revokeObjectURL(h.thumbnail.src),y(M(u=>{u.splice(d,1)})),P(s)},S=()=>{for(const s of o)URL.revokeObjectURL(s.src),URL.revokeObjectURL(s.thumbnail.src);y([]),U()},U=()=>{for(const s of m)URL.revokeObjectURL(s[1].src),URL.revokeObjectURL(s[1].thumbnail.src);c([]),i(""),g("blue")},E=s=>{I(s)},R=async()=>{try{l.current=new te,await l.current.initService("encryption");const s=l.current.getPlugins();console.log("plugins",s),s.length&&b(s)}catch(s){console.error(s)}};a.useEffect(()=>(R(),()=>{l.current=null}),[]);const z=async s=>{if(!(!o.length||!l.current)){x(!0),c([]),g("blue");try{console.log("options",s);const d=u=>{i(u.message),u.done&&u.error&&g("red")},h=l.current.processing(o,s,"encryption",d);for await(const u of h)u&&c(M(t=>{t.push([u[0],u[1]])}))}catch(d){console.error(d)}finally{x(!1)}}},D=async()=>{if(!(p||w||!m.length)){v(!0);try{const s=m.map(([,{file:d}])=>d);await se(s,"encrypted-images")}catch(s){console.error(s)}finally{v(!1)}}},C=a.useMemo(()=>p||w||L,[p,w,L]),A=a.useMemo(()=>p||m.length/o.length>0,[o.length,m.length,p]);return e("div",{className:"w-full h-full overflow-auto",children:f("div",{className:"h-full grid grid-rows-[55%_calc(45% - 0.75rem)] grid-cols-[minmax(300px,auto)_minmax(300px,400px)] gap-3",children:[e("div",{className:"border-2 border-gray-200 rounded-lg p-2",children:e("div",{className:"relative h-full w-full overflow-y-auto overflow-x-hidden",children:e(Y,{className:"absolute w-full select-none",list:o,onAdd:k,onRemove:j,disabled:C,onUploadStateChange:E})})}),e("div",{className:"border-2 border-gray-200 rounded-lg p-2",children:e("div",{className:"relative h-full w-full overflow-y-auto overflow-x-hidden",children:e(ne,{onStart:z,onClearUpload:S,onClearOutput:U,pluginList:N,className:"absolute w-full select-none",disabled:C})})}),f("div",{className:"flex flex-col col-span-2",children:[e("div",{className:"flex-1 border-2 rounded-lg overflow-hidden",children:e(le,{pairList:m,onRemove:P,disabled:C})}),f("div",{className:`mt-3 flex items-center ${A?"":"hidden"}`,children:[f("div",{className:"p-2 border-2 border-gray-200 shadow-sm rounded-lg flex-1 relative",children:[e("span",{className:"absolute z-10 left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 select-none",children:r}),e(Z,{current:m.length,total:o.length,type:"fraction",color:O})]}),e("div",{onClick:D,className:`p-2 border-2 border-gray-200 shadow-sm rounded-lg ml-2 hover:bg-gray-200 ${C?"!bg-gray-100":""}`,children:e(ee,{fill:C?"#ccc":"#000",className:"w-4 h-4"})})]})]})]})})}export{ie as default};
