import{r as a,j as g,a as e,f as A}from"./index-d483e458.js";import{L as K,C as T,B as D,c as _,T as q,a as F,S as G,g as H,b as J,s as Q,U as V,P as W,d as X,f as M,I as Y,m as Z}from"./zip-3b3435a7.js";const ee=[{title:"写入信息",description:"使用当前算法往图像中写入信息"},{title:"提取信息",description:"使用当前算法从图像中提取信息"}],$=l=>g("div",{className:"flex items-center mb-4 relative",children:[e("div",{className:"w-[64px] mr-3 whitespace-nowrap text-justify relative",style:{textAlignLast:"justify"},children:l.label}),l.children,l.message&&e("span",{className:"absolute ml-[32px] -bottom-[2px] left-1/2 -translate-x-1/2 translate-y-full text-xs text-red-400",children:l.message})]});function te({onStart:l,className:x,pluginList:d,disabled:o,onClearUpload:v,onClearOutput:f}){const[n,m]=a.useState(0),[h,y]=a.useState(0),[p,S]=a.useState(""),[C,i]=a.useState(""),[u,O]=a.useState(1),[b,N]=a.useState(""),w=(t,s)=>s!=null&&s.required&&t===""?(N("秘钥不能为空"),!1):s!=null&&s.required&&(s!=null&&s.regex)&&!new RegExp(s.regex).test(t)?(N(s.message),!1):(N(""),!0),P=()=>{const t=d[n],s=["encrypt","decrypt"];w(p,t.keyRule)&&(l==null||l({pluginName:t.name,optionName:s[h],key:p,message:h?"":C,repeat:u}))},L=t=>{m(t)},U=t=>{y(t)},j=t=>{const s=t.target.value;S(s);const c=d[n];w(s,c==null?void 0:c.keyRule)},I=t=>{i(t.target.value)},R=t=>{const s=Number(t.target.value);O(Math.max(s,1))},E=()=>{v==null||v()},k=()=>{f==null||f()},z=t=>t.name??"未载入算法",r=t=>g(a.Fragment,{children:[e("div",{className:"font-semibold",children:t.name}),e("div",{className:"text-xs truncate my-1",children:t.description}),g("div",{className:"flex justify-between text-xs ",children:[e("span",{className:"text-gray-500",children:_(t.language)}),e("span",{className:"text-gray-400",children:t.version})]})]});return g("div",{className:`text-gray-600 p-3 ${x??""}`,children:[e(K,{options:d,checkedIndex:n,disabled:o,onChange:L,renderSelected:z,renderList:r,className:"mb-4"}),e(T,{options:ee,disabled:o,onChange:U,className:"mb-4"}),e($,{label:"秘钥",message:b,children:e("input",{type:"text",value:p,min:1,disabled:o,onChange:j,className:`${o?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),e($,{label:"信息重复",children:e("input",{type:"number",value:u,disabled:o,onChange:R,className:`${o?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),!!h||e($,{label:"载入信息",children:e("input",{type:"text",value:C,disabled:o,onChange:I,className:`${o?"!bg-gray-200":""} bg-gray-50 border flex-1 border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 py-2 px-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500`})}),g("div",{className:"text-center pt-2",children:[e(D,{disabled:o,onClick:E,typeColor:"white",className:"mb-2 mr-2",children:"清空上传"}),e(D,{disabled:o,onClick:k,typeColor:"white",className:"mb-2 mr-2",children:"清空输出"}),g(D,{onClick:P,disabled:o,className:"mb-2",children:["开始",h?"解密":"加密"]})]})]})}const re=[{title:"隐写图",key:"image"},{title:"原图大小",key:"originSize"},{title:"隐写图大小",key:"currentSize"},{title:"压缩率",key:"compressionRatio"},{title:"承载信息",key:"message"},{title:"操作",key:"operate"}];function se({pairList:l,className:x,disabled:d,onRemove:o}){const[v,f]=a.useState(!1),[n,m]=a.useState(null),h=(i,u)=>{f(!0),m({src:i,name:u})},y=()=>{f(!1),m(null)},p=i=>{d||o==null||o(i)},S=({file:i})=>{d||Q(i,i.name)},C=()=>Array.from(l,([i,u,O])=>{const b=i.md5,N=e(J,{file:u,onClick:()=>h(u.src,u.file.name)}),w=A(i.file.size,"MB"),P=A(u.file.size,"MB"),L=H(i.file,u.file),U=g("div",{children:[e("span",{onClick:()=>S(u),className:"cursor-pointer select-none text-blue-500 font-semibold text-sm underline underline-offset-2 mx-2",children:"下载"}),e("span",{onClick:()=>p(i.md5),className:"cursor-pointer select-none text-red-500 font-semibold text-sm underline underline-offset-2 mx-2",children:"删除"})]});return{id:b,image:N,originSize:w,currentSize:P,compressionRatio:g("span",{className:`${L>100?"text-red-500":"text-green-500"}`,children:[L,"%"]}),message:e("div",{className:"max-w-sm max-h-40 whitespace-normal break-words overflow-y-auto overflow-x-hidden",children:O}),operate:U}});return g(a.Fragment,{children:[e("div",{className:`relative w-full h-full ${x??""}`,children:e("div",{className:"absolute w-full h-full overflow-y-auto",children:e(q,{columns:re,data:C()})})}),g(F,{isOpen:v,className:"w-full h-full flex justify-center items-center relative",children:[e("div",{className:"w-full h-full overflow-auto p-6 flex",children:n&&e("a",{href:n==null?void 0:n.src,download:n==null?void 0:n.name,className:"m-auto",onClick:i=>i.preventDefault(),children:e("img",{src:n==null?void 0:n.src,style:{backgroundImage:`linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%),
                linear-gradient(45deg, black 25%, transparent 25%, transparent 75%, black 75%)`,backgroundSize:"40px 40px",backgroundPosition:"0 0, 20px 20px"}})})}),e("button",{className:"text-black fixed top-3 right-3",onClick:y,children:e(G,{})})]})]})}function le(){const[l,x]=a.useState([]),[d,o]=a.useState([]),[v,f]=a.useState([]),n=a.useRef(null),[m,h]=a.useState(!1),[y,p]=a.useState(!1),[S,C]=a.useState(!1),[i,u]=a.useState(""),[O,b]=a.useState("blue"),N=(r,t)=>{x(M(s=>{s.splice(t,0,...r)}))},w=r=>{const t=d.findIndex(c=>c[0].md5===r);if(t==-1)return;u(""),b("blue");const s=d[t];s&&(URL.revokeObjectURL(s[1].src),URL.revokeObjectURL(s[1].thumbnail.src),o(M(c=>{c.splice(t,1)})))},P=r=>{const t=l.findIndex(c=>c.md5===r);if(t==-1)return;const s=l[t];URL.revokeObjectURL(s.src),URL.revokeObjectURL(s.thumbnail.src),x(M(c=>{c.splice(t,1)})),w(r)},L=()=>{for(const r of l)URL.revokeObjectURL(r.src),URL.revokeObjectURL(r.thumbnail.src);x([]),U()},U=()=>{for(const r of d)URL.revokeObjectURL(r[1].src),URL.revokeObjectURL(r[1].thumbnail.src);o([]),u(""),b("blue")},j=r=>{C(r)},I=async()=>{try{n.current=new Y,await n.current.initService("steganography");const r=n.current.getPlugins();console.log("plugins",r),r.length&&f(r)}catch(r){console.error(r)}};a.useEffect(()=>(I(),()=>{n.current=null}),[]);const R=async r=>{if(!(!l.length||!n.current)){h(!0),o([]),b("blue");try{console.log("options",r);const t=c=>{u(c.message),c.done&&c.error&&b("red")},s=n.current.processing(l,r,"steganography",t);for await(const c of s)c&&o(M(B=>{B.push(c)}))}catch(t){console.error(t)}finally{h(!1)}}},E=async()=>{if(!(m||y||!d.length)){p(!0);try{const r=d.map(([,{file:t}])=>t);await Z(r,"encrypted-images")}catch(r){console.error(r)}finally{p(!1)}}},k=a.useMemo(()=>m||y||S,[m,y,S]),z=a.useMemo(()=>m||d.length/l.length>0,[l.length,d.length,m]);return g("div",{className:"h-full grid grid-rows-[55%_45%] grid-cols-[minmax(300px,auto)_minmax(300px,400px)] gap-3",children:[e("div",{className:"border-2 border-gray-200 rounded-lg p-2",children:e("div",{className:"relative h-full w-full overflow-y-auto overflow-x-hidden",children:e(V,{className:"absolute w-full select-none",list:l,onAdd:N,onRemove:P,disabled:k,onUploadStateChange:j})})}),e("div",{className:"border-2 border-gray-200 rounded-lg p-2",children:e("div",{className:"relative h-full w-full overflow-y-auto overflow-x-hidden",children:e(te,{onStart:R,onClearUpload:L,onClearOutput:U,pluginList:v,className:"absolute w-full select-none",disabled:k})})}),g("div",{className:"flex flex-col col-span-2",children:[e("div",{className:"flex-1 border-2 rounded-lg overflow-hidden",children:e(se,{pairList:d,onRemove:w,disabled:k})}),g("div",{className:`mt-3 flex items-center ${z?"":"hidden"}`,children:[g("div",{className:"p-2 border-2 border-gray-200 shadow-sm rounded-lg flex-1 relative",children:[e("span",{className:"absolute z-10 left-1/2 -translate-x-1/2 top-1/2 -translate-y-1/2 select-none",children:i}),e(W,{current:d.length,total:l.length,type:"fraction",color:O})]}),e("div",{onClick:E,className:`p-2 border-2 border-gray-200 shadow-sm rounded-lg ml-2 hover:bg-gray-200 ${k?"!bg-gray-100":""}`,children:e(X,{fill:k?"#ccc":"#000",className:"w-4 h-4"})})]})]})]})}export{le as default};
