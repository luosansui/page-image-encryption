import{c as z}from"./index-0e062450.js";import O from"./mersenne-twister-24a2e2e6.js";import{utf8Encode as S,utf8Decode as x}from"./utf_8-d043cfed.js";import"./index-7a388a79.js";import"./zip-4713de7c.js";function I(r,t){const o=Array.from(Array(t).keys()),f=[];let s;const c=z.SHA512(r).words.reduce(function(e,u){return e+Math.abs(u)},0),n=new O(c);for(let e=t;e>0;e--)s=n.genrand_int32()%e,f.push(o[s]),o[s]=o[e-1];return f}function F(r,t){const o=S(r),f=[],s=o.length;for(let c=0;c<s;c++)for(let n=128;n>0;n=Math.floor(n/2))if(Math.floor(o[c]/n)){for(let e=0;e<t;e++)f.push(1);o[c]-=n}else for(let e=0;e<t;e++)f.push(0);for(let c=0;c<24;c++)for(let n=0;n<t;n++)f.push(1);return f}function H(r,t){function o(e){const u=e.length;let l=0;for(let i=0;i<u;i++)l+=e[i];return Math.round(l/u)}const f=[];let s,c;const n=Math.floor(Math.floor(r.length/t)/8);for(let e=0;e<n;e++){s=0,c=128;for(let u=0;u<8;u++)s+=o(r.slice((e*8+u)*t,(e*8+u+1)*t))*c,c=Math.floor(c/2);if(s==255)break;f.push(s)}return x(f)}function J(r,t,o){const f=r.length;if(r.length>o)throw"Can not hold this many data!";const s=Array(o);for(let n=0;n<o;n++)s[n]=Math.floor(Math.random()*2);const c=I(t,o);for(let n=0;n<f;n++)s[c[n]]=r[n];return s}function q(r,t,o,f,s){const c=f?(Math.floor(t/8)*Math.floor(r/8)-1)*o.length:0,n=s?16:8,e=(Math.floor(t/n)*Math.floor(r/n)-1)*o.length;return[c,e]}function v(r,t,o){return[.299*r+.587*t+.114*o,128-.168736*r-.331264*t+.5*o,128+.5*r-.418688*t-.081312*o]}function L(r,t,o){return[r+1.402*(o-128),r-.344136*(t-128)-.714136*(o-128),r+1.772*(t-128)]}function k(r,t,o,f,s){const c=Array(t*t);for(let n=0;n<t;n++)for(let e=0;e<t;e++)c[n*t+e]=r[(o+n)*s+f+e];return c}function A(r){const t=Array(64).fill(0);let o,f,s;for(let c=0;c<8;c++)for(let n=0;n<8;n++){o=c==0?1/Math.sqrt(2):1,f=n==0?1/Math.sqrt(2):1,s=0;for(let e=0;e<8;e++)for(let u=0;u<8;u++)s+=r[e*8+u]*Math.cos((2*e+1)*c*Math.PI/16)*Math.cos((2*u+1)*n*Math.PI/16);t[c*8+n]=1/4*o*f*s}return t}function B(r){const t=Array(64).fill(0);let o,f,s;for(let c=0;c<8;c++)for(let n=0;n<8;n++){s=0;for(let e=0;e<8;e++)for(let u=0;u<8;u++)o=e==0?1/Math.sqrt(2):1,f=u==0?1/Math.sqrt(2):1,s+=o*f*r[e*8+u]*Math.cos((2*c+1)*e*Math.PI/16)*Math.cos((2*n+1)*u*Math.PI/16);t[c*8+n]=1/4*s}return t}function E(r){const t=[16,11,10,16,24,40,51,61,12,12,14,19,26,58,60,55,14,13,16,24,40,57,69,56,14,17,22,29,51,87,80,62,18,22,37,56,68,109,103,77,24,35,55,64,81,104,113,92,49,64,78,87,103,121,120,101,72,92,95,98,112,100,103,99];for(let o=0;o<64;o++)t[o]*=r;return t}function P(r,t,o,f){if(t.length!=f.length)throw"LOC and ENCODE_BITS have different sizes! This is a bug in code!";const s=E(r),c=Array(64).fill(0);let n,e,u;for(let l=0;l<t.length;l++)n=o[t[l]]/s[t[l]],e=Math.floor(n),Math.abs(e%2)!=f[l]&&(e-=1),u=Math.ceil(n),Math.abs(u%2)!=f[l]&&(u+=1),n-e>u-n&&(e=u),c[t[l]]=e*s[t[l]]-o[t[l]];return c}function Q(r,t,o,f,s,c){for(let n=0;n<t;n++)for(let e=0;e<t;e++)r[(o+n)*s+f+e]=c[n*t+e]}function w(r,t,o,f,s,c){const n=Math.floor(o/8),e=Math.floor(t/8),u=c.length;if(u*(n*e-1)!=f.length)throw"Image size does not match data size (Y channel)";let l;for(let i=0;i<n;i++)for(let h=0;h<e;h++){let a=k(r,8,i*8,h*8,t),_=A(a);if(i==0&&h==0){l=_;continue}const M=_.map(function(g,y){return g-l[y]}),m=P(s,c,M,f.slice(u*(i*e+h-1),u*(i*e+h)));_=_.map(function(g,y){return g+m[y]}),a=B(_),Q(r,8,i*8,h*8,t,a)}}function T(r){const t=Array(64);for(let o=0;o<8;o++)for(let f=0;f<8;f++)t[o*8+f]=(r[o*2*8+f*2]+r[(o*2+1)*8+f*2]+r[o*2*8+f*2+1]+r[(o*2+1)*8+f*2+1])/4;return t}function N(r){const t=Array(256);for(let o=0;o<16;o++)for(let f=0;f<16;f++)t[o*16+f]=r[Math.floor(o/2)*8+Math.floor(f/2)];return t}function Y(r,t,o,f,s,c){const n=Math.floor(o/16),e=Math.floor(t/16),u=c.length;if(u*(n*e-1)!=f.length)throw"Image size does not match data size (CbCr channel)";let l;for(let i=0;i<n;i++)for(let h=0;h<e;h++){let a=k(r,16,i*16,h*16,t);const _=T(a);let M=A(_);if(i==0&&h==0){l=M;continue}const m=M.map(function(d,p){return d-l[p]}),g=P(s,c,m,f.slice(u*(i*e+h-1),u*(i*e+h)));M=M.map(function(d,p){return d+g[p]});let b=B(M).map(function(d,p){return d-_[p]});b=N(b),a=a.map(function(d,p){return d+b[p]}),Q(r,16,i*16,h*16,t,a)}}function j(r){let t=Math.round(r);return t=t>255?255:t,t<0?0:t}function G(r,t,o,f,s,c,n,e){const u=q(t,o,c,n,e),l=u[0],i=u[1],h=[],a=[],_=[],M=[];for(let b=0;b<r.length;b+=4){const d=v(r[b],r[b+1],r[b+2]);h.push(d[0]),a.push(d[1]),_.push(d[2]),M.push(r[b+3])}n&&w(h,t,o,f.slice(0,l),s,c);const m=e?Y:w;m(a,t,o,f.slice(l,l+i),s,c),m(_,t,o,f.slice(l+i,l+i+i),s,c);let g=0;const y=new Uint8ClampedArray(r.length);for(let b=0;b<r.length;b+=4){const d=L(h[g],a[g],_[g]);y[b]=j(d[0]),y[b+1]=j(d[1]),y[b+2]=j(d[2]),y[b+3]=M[g],g+=1}return y}function K(r,t){const o=r.length,f=Array(o),s=I(t,o);for(let c=0;c<o;c++)f[c]=r[s[c]];return f}function U(r,t,o){const f=E(r),s=[];for(let c=0;c<t.length;c++)s.push(Math.abs(Math.round(o[t[c]]/f[t[c]])%2));return s}function C(r,t,o,f,s){const c=Math.floor(o/8),n=Math.floor(t/8),e=[];let u;for(let l=0;l<c;l++)for(let i=0;i<n;i++){const h=k(r,8,l*8,i*8,t),a=A(h);if(l==0&&i==0){u=a;continue}e.push(U(f,s,a.map(function(_,M){return _-u[M]})))}return e.flat()}function R(r,t,o,f,s){const c=Math.floor(o/16),n=Math.floor(t/16),e=[];let u;for(let l=0;l<c;l++)for(let i=0;i<n;i++){let h=k(r,16,l*16,i*16,t);h=T(h);const a=A(h);if(l==0&&i==0){u=a;continue}e.push(U(f,s,a.map(function(_,M){return _-u[M]})))}return e.flat()}function V(r,t,o,f,s,c,n){const e=[],u=[],l=[],i=[];for(let a=0;a<r.length;a+=4){const _=v(r[a],r[a+1],r[a+2]);e.push(_[0]),u.push(_[1]),l.push(_[2])}c&&i.push(C(e,t,o,f,s));const h=n?R:C;return i.push(h(u,t,o,f,s)),i.push(h(l,t,o,f,s)),i.flat()}function tt(r,t,o=23,f=2,s=[2,9,16],c=!0,n=!1){const e=new Uint8ClampedArray(r.buffer),u=V(e,r.width,r.height,f,s,c,n),l=K(u,t);return H(l,o)}const rt=(r,t,o,f=23,s=2,c=[2,9,16],n=!0,e=!1)=>{const u=new Uint8ClampedArray(r.buffer);let l=r.buffer,i=u.length/4*3;const h=q(r.width,r.height,c,n,e);i=h[0]+2*h[1];let a=F(t,f);return a=J(a,o,i),l=G(u,r.width,r.height,a,s,c,n,e),{width:r.width,height:r.height,name:r.name,buffer:l}};export{tt as readMsgFromImage,rt as writeMsgToImage};
